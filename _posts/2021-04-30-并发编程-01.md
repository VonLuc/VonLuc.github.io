---
layout:     post   				    							
title:      并发编程01 				
subtitle:   7天掌握并发编程
date:       2021-04-30 											
author:     Zhan 												
header-img: img/post-bg-2015.jpg 								
catalog: true 													
tags:														
    - 并发编程 
---

# 并发编程01

​	因公司项目需要，目前在快速阅读学习由方腾飞作，机械工业出版社出版的《java并发编程艺术》，希望提炼精简相关知识点和个人思考总结，希望在7天内完成一个版本，系列文章以并发编程(01-07)的结构发篇处理，如出现理解偏差，欢迎评论指正；

## 术语描述

阅读前提假设java、线程相关概念理论、代码已熟悉；



## 使用并发会遇到的问题、并发的底层原理与实现

### 使用并发会遇到的问题

#### 上下文切换

​	多线程的执行，实质为CPU为每个线程分配时间片执行各自任务，时间片的分配有指定的算法实现，时间片一般为几十毫秒ms；

​	时间片的切换过程：切换前保存上一个任务的状态，切换线程，切换回原任务时加载之前保存的状态。任务的保存到再加载的过程为一次上下文切换；

​	并发中线程存在线程创建和上下文切换开销，对于这种情况我们需要量化监控:

​		·使用Lmbench3测量上下文切换的时长；

​		·使用vmstat测量上下文切换次数；

##### 如何减少上下文切换

​	减少上下文切换的方法有无锁并发变成、CAS算法、使用最少线程和使用协程；

​	无锁并发编程：多线程竞争锁时，会引起上下文切换，故多线程时可想办法避免使用锁，如将数据的ID按照Hash算法取模分段，不同线程处理不同段的数据；

​	CAS算法：java的Atomic包使用CAS算法更新数据，且不需要加锁；

​	使用最少线程：避免创建不需要的线程，比如任务少缺创建很多线程会造成大量线程都处于等待状态；

​	协程：单线程里实现多任务调度，并在单线程里维持多个任务间的切换 ；

##### 减少上下文切换实战

